Path:  ["..", "data", "datasources", "BEA", "GDP", "State"]

CSVInput:
  - {name: SAGDP2N__ALL_AREAS_1997_2017.csv, descriptor: SAGDP2N}
  # name:
  #   - SAGDP2N__ALL_AREAS_1997_2017.csv
    # - SAGDP3N__ALL_AREAS_1997_2017.csv
    # - SAGDP4N__ALL_AREAS_1997_2017.csv
    # - SAGDP5N__ALL_AREAS_1997_2017.csv
    # - SAGDP6N__ALL_AREAS_1997_2017.csv
    # - SAGDP7N__ALL_AREAS_1997_2017.csv
    # - SAGDP8N__ALL_AREAS_1997_2017.csv
    # - SAGDP9N__ALL_AREAS_1997_2017.csv
    # - SAGDP11N__ALL_AREAS_1998_2017.csv
  # descriptor:
  #   - SAGDP2N
    # - SAGDP3N
    # - SAGDP4N
    # - SAGDP5N
    # - SAGDP6N
    # - SAGDP7N
    # - SAGDP8N
    # - SAGDP9N
    # - SAGDP11N

Order:
  - {col: year,          type: Int}
  - {col: region_code,   type: String}
  - {col: region_desc,   type: String}
  - {col: component,     type: String}
  - {col: industry_id,   type: String}
  - {col: industry_code, type: String}
  - {col: industry_desc, type: String}
  - {col: units,         type: String}
  - {col: value,         type: Float64}

Rename:
  - {from: GeoFIPS, to: region_code}
  - {from: GeoName, to: region_desc}
  - {from: Unit, to: units}
  - {from: Description, to: industry_desc}
  - {from: ComponentName, to: component}
  - {from: IndustryClassification, to: industry_code}
  - {from: IndustryId, to: industry_id}

Melt:
  on: [region_code, region_desc, component, units, industry_id, industry_code, industry_desc]
  var: year
  val: value
  type: Any

Map:
  # - file:   std/regions.csv
  #   from:   from
  #   to:     to
  #   input:  region
  #   output: region
  - file:   std/gsp.csv
    from:   from
    to:     to
    input:  component
    output: component
  # - file:   units.csv
  #   from:   from
  #   to:     to
  #   input:  units
  #   output: units

Drop:
  - col: [Region, TableName]
    val: all
    operation: "=="
  - col: value
    val: [missing, "(NA)", "(L)", "(D)", "(H)", "(T)"]
    operation: "=="
  - col: component
    val: missing
    operation: "=="

Match:
  on: "(?<region_desc>.*)\\*"
  input: region_desc
  output: region_desc

# Replace:
#   col:  region
#   from: "United States*"
#   to:    us