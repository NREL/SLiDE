Path:  ["..", "data", "datasources", "USATradeOnline"]

CSVInput:
  - name: "State Imports by NAICS Commodities.csv"
    descriptor: import
  - name:  "State Exports by NAICS Commodities.csv"
    descriptor: export

Order:
  - {col: year,                      type: Int}
  - {col: flow,                      type: String}
  - {col: state,                     type: String}
  - {col: country,                   type: String}
  - {col: naics_industry_group_code, type: String}
  # - {col: naics_industry_group_desc, type: String}
  - {col: units,                     type: String}
  - {col: value,                     type: Float64}

Rename:
  - from: upper
    to:   lower
  - from: time
    to:   year
  - from: "customs value (gen) ($us)"
    to:   value
  - from: total exports value ($us)
    to:   value

Describe:
  col: flow

Map:
  file:   regions.csv
  from:   from
  to:     to
  input:  [state, country]
  output: [state, country]

Drop:
  col: year
  val: 2017 through November
  operation: "=="

Add:
  col: units
  val: us dollars (USD)

Match:
  on:     "(?<naics_industry_group_code>\\d*) (?<naics_industry_group_desc>.*)"
  input:  commodity
  output: [naics_industry_group_code, naics_industry_group_desc]