# Autogenerated from generate_yaml.xlsx
Editable: true

Path: [.., data, datasources, PCE]

PathOut: [.., data, output, pce.csv]

CSVInput:
  - {name: SAEXP1_1997_2017_ALL_AREAS_.csv, descriptor: Total personal consumption expenditures (PCE) by state}
# - {name: SAEXP2_1997_2017_ALL_AREAS_.csv, descriptor: Per capita personal consumption expenditures (PCE) by state}

# Describe:
#   col: component

Order:
  - {col: yr,        type: Int}
  - {col: r,         type: String}
# - {col: component, type: String}
  - {col: pg,        type: String}
# - {col: desc,      type: String}
  - {col: units,     type: String}
  - {col: value,     type: Float64}

Rename:
  - {from: GeoName,       to: r}
  - {from: ComponentName, to: component}
  - {from: Description,   to: desc}
  - {from: Unit,          to: units}

# Match:
# - on:     \"(?<region_code>.{2})000\"
#   input:  region_code
#   output: region_code

Melt:
  on:  [r, component, desc, units]
  var: yr
  val: value

Map:
  - file:   [parse, pce.csv]
    from:   from
    to:     to
    input:  desc
    output: pg
  - file:   [parse, regions.csv]
    from:   from
    to:     to
    input:  r
    output: r
  - file:   [parse, units.csv]
    from:   from
    to:     [to, factor, units_factor]
    input:  units
    output: [units, factor, units_factor]

Drop:
  - col: [GeoFIPS, Region, TableName, ComponentName, Line, IndustryClassification]
    val: all
    operation: "=="
# - col: component
#   val: Per capita personal consumption expenditures (PCE) by state
#   operation: "=="
# - col: value
#   val: missing
#   operation: "=="

Operate:
  operation: "*"
  axis:   col
  from:   units
  to:     units_factor
  input:  [value, factor]
  output: value
