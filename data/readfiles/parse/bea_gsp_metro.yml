# Autogenerated from generate_yaml.xlsx
# TODO: industry_code, units, region/region level, region_code 00998
Editable: true

Path:  [.., data, datasources, BEA, GDP, Metro]

PathOut: [.., data, output, gsp_metro.csv]

CSVInput:
  - {name: MAGDP2_2001_2017_ALL_AREAS.csv,  descriptor: gdp}
  - {name: MAGDP8_2001_2017_ALL_AREAS.csv,  descriptor: qty}
  - {name: MAGDP9_2001_2017_ALL_AREAS.csv,  descriptor: rgdp}
# - {name: MAGDP10_2001_2017_ALL_AREAS.csv, descriptor: Per capita real GDP by metropolitan area}

# Describe:
#  col: gdpcat

Order:
  - {col: yr,     type: Int}
  - {col: r,      type: String}
  - {col: r_desc, type: String}
  - {col: gdpcat, type: String}
  - {col: si,     type: String}
# - {col: n,      type: String}
# - {col: desc,   type: String}
  - {col: units,  type: String}
  - {col: value,  type: Float64}
# - {col: units_0, type: String}
# - {col: value_0, type: Any}
# - {col: factor,  type: Any}

Rename:
  - {from: GeoFIPS,                to: r}
  - {from: GeoName,                to: r_desc}
  - {from: ComponentName,          to: gdpcat}
  - {from: IndustryId,             to: si}
  - {from: Unit,                   to: units}
  - {from: IndustryClassification, to: n}
  - {from: Description,            to: desc}

Melt:
  on:  [r, gdpcat, si, units, si, n, desc]
  var: yr
  val: value

Map:
  - file:   [parse, gsp.csv]
    from:   from
    to:     to
    input:  gdpcat
    output: gdpcat
  - file:   [scale, census_cbsa.csv]
    from:   cbsa_code
    to:     cbsa_desc
    input:  r
    output: r_desc
  - file:   [parse, units.csv]
    from:   from
    to:     [to, factor, units_factor]
    input:  units
    output: [units, factor, units_factor]

Replace:
  - col:  value
    from: [missing, (NA), (D), (H), (L), (T)]
    to:   0

Drop:
  - col: [Region, TableName, GeoName]
    val: all
    operation: "=="
# - col: r_desc
#   val: missing
#   operation: "=="
  - col: gdpcat
    val: missing
    operation: "=="

Operate:
  operation: "*"
  axis:   col
  from:   units
  to:     units_factor
  input:  [value, factor]
  output: value
