# Autogenerated from generate_yaml.xlsx

Path:  ["..", "data", "datasources", "USATradeOnline"]

PathOut: ["..", "data", "output", "utd.csv"]

CSVInput:
  - {name: "State Imports by NAICS Commodities.csv", descriptor: import}
  - {name: "State Exports by NAICS Commodities.csv", descriptor: export}

Describe:
  col: flow

Order:
  - {col: year,        type: Int}
  - {col: flow,        type: String}
  - {col: state,       type: String}
  - {col: country,     type: String}
  - {col: naics_code,  type: String}
  - {col: naics_level, type: Any}
  - {col: units,       type: String}
  - {col: value,       type: Float64}

Rename:
  - {from: upper, to: lower}
  - {from: time,  to: year}
  - {from: ["customs value (gen) ($us)", "total exports value ($us)"], to: value}

Match:
  on:     (?<naics_code>\d*) (?<naics_desc>.*)
  input:  commodity
  output: [naics_code, naics_desc]

Add:
  col: units
  val: us dollars (USD)

Map2:
  - file:   [std, naics.csv]
    from:   naics_code
    to:     naics_level
    input:  naics_code
    output: naics_level
  - file:   [std, regions.csv]
    from:   from
    to:     to
    input:  state
    output: state
  - file:   [std, regions.csv]
    from:   from
    to:     to
    input:  country
    output: country

Drop:
  col: year
  val: 2017 through November
  operation: "=="
