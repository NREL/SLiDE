# Autogenerated from generate_yaml.xlsx
Editable: true

Path:  [.., data, datasources, USATradeOnline]

PathOut: [.., data, output, utd.csv]

CSVInput:
  - {name: "State Imports by NAICS Commodities.csv", descriptor: imports}
  - {name: "State Exports by NAICS Commodities.csv", descriptor: exports}

Describe:
  col: t

Order:
  - {col: yr,      type: Int}
  - {col: t,       type: String}
  - {col: r,       type: String}
# - {col: country, type: String}
  - {col: n,       type: String}
# - {col: n_level, type: Any}
  - {col: units,   type: String}
  - {col: value,   type: Float64}
# - {col: units_0, type: String}
# - {col: value_0, type: Any}
# - {col: factor,  type: Any}

Rename:
  - {from: upper, to: lower}
  - {from: time,  to: yr}
  - {from: state, to: r}
  - {from: ["customs value (gen) ($us)", "total exports value ($us)"], to: value}

Match:
  on:     (?<n>\d*) (?<n_desc>.*)
  input:  commodity
  output: [n, n_desc]

Add:
  col: units
  val: us dollars (USD)

Map:
# - file:   [parse, naics.csv]
#   from:   naics_code
#   to:     naics_level
#   input:  n
#   output: n_level
  - file:   [parse, regions.csv]
    from:   from
    to:     to
    input:  r
    output: r
  - file:   [parse, regions.csv]
    from:   from
    to:     to
    input:  country
    output: country
  - file:   [parse, units.csv]
    from:   from
    to:     [to, factor, units_factor]
    input:  units
    output: [units, factor, units_factor]

Drop:
  - col: yr
    val: 2017 through November
    operation: "=="
  - col: country
    val: world total
    operation: "!="
  - col: r
    val: unknown
    operation: "=="

Operate:
  operation: "*"
  axis:   col
  from:   units
  to:     units_factor
  input:  [value, factor]
  output: value
