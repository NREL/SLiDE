# Autogenerated from generate_yaml.xlsx
Editable: true

Path: [data, datasources, CFS]

PathOut: [data, output, cfs.csv]

CSVInput:
  name: cfs_2012_pumf_csv.txt
  descriptor: 2012

Describe:
  col: yr

Order:
  - {col: yr,                       type: Int}
  - {col: shipmt_id,                type: Int}
  - {col: orig_state,               type: String}
  - {col: orig_metro,               type: Int}
  - {col: dest_state,               type: String}
  - {col: dest_metro,               type: Int}
  - {col: quarter,                  type: Int}
  - {col: n,                        type: Int}
# - {col: n_level,                  type: String}
  - {col: sg,                       type: Int}
  - {col: mode,                     type: Int}
  - {col: temp_cntl_yn,             type: Bool}
  - {col: export_yn,                type: Bool}
  - {col: export_cntry,             type: String}
  - {col: hazmat,                   type: String}
  - {col: units,                    type: String}
  - {col: value,                    type: Float64}
  - {col: wgt_factor,               type: Float64}
  - {col: shipmt_value_units,       type: String}
  - {col: shipmt_value,             type: Int}
  - {col: shipmt_wght_units,        type: String}
  - {col: shipmt_wght,              type: Int}
  - {col: shipmt_dist_gc_units,     type: String}
  - {col: shipmt_dist_gc,           type: Int}
  - {col: shipmt_dist_routed_units, type: String}
  - {col: shipmt_dist_routed,       type: Int}

Rename:
  - {from: upper,   to: lower}
  - {from: orig_ma, to: orig_metro}
  - {from: dest_ma, to: dest_metro}
  - {from: naics,   to: n}
  - {from: sctg,    to: sg}

Add:
  - {col: shipmt_value_units,       val: us dollars (USD)}
  - {col: shipmt_wght_units,        val: weight of shipment in pounds}
  - {col: shipmt_dist_gc_units,     val: great circle distance in miles}
  - {col: shipmt_dist_routed_units, val: routed distance in miles}

Map:
  - file:   [parse, regions.csv]
    from:   from
    to:     to
    input:  orig_state
    output: orig_state
  - file:   [parse, regions.csv]
    from:   from
    to:     to
    input:  dest_state
    output: dest_state
  - file:   [parse, regions.csv]
    from:   from
    to:     to
    input:  export_cntry
    output: export_cntry
  - file:   [parse, units.csv]
    from:   from
    to:     [to, factor, units_factor]
    input:  shipmt_value_units
    output: [units, factor, units_factor]

Replace:
  - col:  temp_cntl_yn
    from: [Y, N]
    to:   [true, false]
  - col:  export_yn
    from: [Y, N]
    to:   [true, false]
  - col:  export_cntry
    from: N
    to:   ""

Drop:
  - {col: sg,       val: "-",  operation: "occursin"}
# !!!! Why is the following dropped?
  - {col: export_yn,  val: true, operation: "=="}
# !!!! I don't think the following should be dropped before the state data is totaled.
  - {col: orig_metro, val: 0,    operation: "=="}
  - {col: dest_metro, val: 0,    operation: "=="}

Operate:
  operation: "*"
  axis:   col
  from:   units
  to:     units_factor
  input:  [shipmt_value, wgt_factor, factor]
  output: value
