# Autogenerated from generate_yaml.xlsx
Editable: true

Path: [.., data, datasources, SEDS]

PathOut: [.., data, output, seds.csv]

CSVInput:
  name: Complete_SEDS_update.csv
  descriptor: seds

Order:
  - {col: year,        type: Int}
  - {col: state,       type: String}
  - {col: msn_code,    type: String}
  - {col: source_code, type: String}
  - {col: sector_code, type: String}
  - {col: units,       type: String}
  - {col: value,       type: Float64}
  - {col: units_0,    type: String}
  - {col: value_0,    type: Any}
  - {col: factor,     type: Any}

Rename:
  - {from: upper,     to: lower}
  - {from: statecode, to: state}
  - {from: msn,       to: msn_code}
  - {from: data,      to: value}

# Match:
#   on:     (?<source_code>.{2})(?<sector_code>.{2})(?<units>.)
#   input:  msn_code
#   output: ["source_code", "sector_code", "units"]

Map:
  - file:   [parse, msn.csv]
    from:   msn_code
    to:     [source_code, sector_code, units]
    input:  msn_code
    output: [source_code, sector_code, units]
  - file:   [parse, regions.csv]
    from:   from
    to:     to
    input:  state
    output: state
  - file:   [parse, units.csv]
    from:   from
    to:     [to, factor, units_factor]
    input:  units
    output: [units, factor, units_factor]

Replace:
  - col:  value
    from: missing
    to:   0.0

Drop:
  - col: "Data_Status"
    val: all
    operation: "=="
  - col: year
    val: 1997
    operation: "<"
# - col: value
#   val: missing
#   operation: "=="

Operate:
  operation: "*"
  from:   units
  to:     units_factor
  input:  [value, factor]
  output: value
