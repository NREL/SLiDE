# Autogenerated from generate_yaml.xlsx
Editable: true

Path:  [.., data, datasources, BEA, GDP, County]

PathOut: [.., data, output, gsp_county.csv]

XLSXInput:
  name:  GCP_Release_1.xlsx
  sheet: Current Dollar GDP
  range: A4:I12456
  descriptor: gsp_county

Order:
  - {col: yr,          type: Int}
  - {col: region,      type: String}
  - {col: state,       type: String}
  - {col: county,      type: String}
  - {col: county_desc, type: String}
  - {col: desc,        type: String}
  - {col: units,       type: String}
  - {col: value,       type: Float64}

Rename:
  - {from: missing,   to: region}
  - {from: missing_1, to: county_desc}
  - {from: missing_2, to: state}
  - {from: missing_3, to: line}
  - {from: missing_4, to: desc}

Match:
  - on:     .{2}(?<county>.{3})
    input:  region
    output: county
# - on:     (?<state>.{2})(?<county>.{3})
#   input:  region
#   output: [state, county]

Melt:
  on:  [region, state, county, county_desc, desc]
  var: yr
  val: value

Add:
  col: units
  val: thousands of us dollars (USD)

Map:
  - file:   [parse, regions.csv]
    from:   from
    to:     to
    input:  state
    output: state
  - file:   [parse, units.csv]
    from:   from
    to:     [to, factor, units_factor]
    input:  units
    output: [units, factor, units_factor]

Replace:
  - col:  value
    from: (D)
    to:   0
  - col:  state
    from: upper
    to:   lower

Drop:
  col: missing_3
  val: all
  operation: "=="

Operate:
  operation: "*"
  axis:   col
  from:   units
  to:     units_factor
  input:  [value, factor]
  output: value
