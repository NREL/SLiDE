<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Sector · SLiDE.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">SLiDE.jl</span></div><form class="docs-search" action="../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../index.html">Home</a></li><li><span class="tocitem">Introduction</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../data/overview.html">Overview</a></li><li><a class="tocitem" href="../data/preparation.html">Preparation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Build</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../build/overview.html">Overview</a></li><li><a class="tocitem" href="../build/partition.html">Partition</a></li><li><a class="tocitem" href="../build/share_region.html">Share</a></li><li><a class="tocitem" href="../build/disagg_region.html">Disaggregate</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox" checked/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Scale</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="overview.html">Overview</a></li><li class="is-active"><a class="tocitem" href="sector.html">Sector</a><ul class="internal"><li><a class="tocitem" href="#Share"><span>Share</span></a></li><li><a class="tocitem" href="#Disaggregate"><span>Disaggregate</span></a></li><li><a class="tocitem" href="#Aggregate"><span>Aggregate</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">EEM</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../eem/seds.html">SEDS</a></li></ul></li><li><a class="tocitem" href="../parameters.html">Parameters</a></li></ul></li><li><span class="tocitem">API</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Types</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/types/parse.html">Parsing</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Functions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/functions/filter.html">Filter and Resize</a></li><li><a class="tocitem" href="../../api/functions/parse.html">Parse</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/internals/build.html">-</a></li><li><a class="tocitem" href="../../api/internals/parse.html">Parse</a></li></ul></li></ul></li><li><a class="tocitem" href="../../api/model.html">Model</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Introduction</a></li><li><a class="is-disabled">Scale</a></li><li class="is-active"><a href="sector.html">Sector</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="sector.html">Sector</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NREL/SLiDE/blob/master/docs/src/man/scale/sector.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Sectoral-Scaling"><a class="docs-heading-anchor" href="#Sectoral-Scaling">Sectoral Scaling</a><a id="Sectoral-Scaling-1"></a><a class="docs-heading-anchor-permalink" href="#Sectoral-Scaling" title="Permalink"></a></h1><p>The build stream produces state-level (regionally) model parameters at the summary-level (sectorally). By default, there are 73 summary-level goods/sectors. These can be disaggregated into 409 detail-level goods/sectors using the <a href="https://github.com/NREL/SLiDEData/blob/master/coremaps/scale/sector/bluenote.csv">blueNOTE sectoral scaling map</a>.</p><p>Scaling features enable the following options:</p><ol><li>Select a subset of summary-level or detail-level goods/sectors to examine.</li><li>Select a combination of summary- and detail-level goods/sectors.</li><li>Aggregate summary- and/or detail-level goods/sectors into those specified in a user-defined map.</li></ol><h2 id="Share"><a class="docs-heading-anchor" href="#Share">Share</a><a id="Share-1"></a><a class="docs-heading-anchor-permalink" href="#Share" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="SLiDE.share_sector!" href="#SLiDE.share_sector!"><code>SLiDE.share_sector!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">share_sector!(dataset::String, d::Dict, set::Dict; kwargs...)</code></pre><p>This function adds sharing information for the sectoral disaggregation to <code>d[:sector]</code>.</p><p>It first reads and partitions (<a href="../build/overview.html#SLiDE.partition"><code>partition</code></a>) detail-level BEA data to calculate  gross output, <span>$y_{yr,g}$</span>, which is used to determine sectoral scaling for disaggregation. 409 detail-level codes are mapped to 73 summary-level codes using the <a href="https://github.com/NREL/SLiDEData/blob/master/coremaps/scale/sector/bluenote.csv">blueNOTE sectoral scaling map</a>, denoted here as <span>$map_{gg\rightarrow g} = map_{ss\rightarrow s}$</span>, where <span>$gg$</span>/<span>$ss$</span> are summary-level goods/sectors and <span>$g$</span>/<span>$s$</span> are detail-level goods/sectors.</p><p>A sectoral disaggregation parameter <span>$\tilde{\delta}_{yr,gg \rightarrow g}$</span> can be defined:</p><p class="math-container">\[\tilde{\delta}_{yr,gg \rightarrow g} = \dfrac
    {y_{yr,g} \circ map_{gg\rightarrow g}}
    {\sum_{gg} y_{yr,g} \circ map_{gg\rightarrow g}}\]</p><p>This process follows two major steps:</p><ol><li><a href="sector.html#SLiDE.share_sector"><code>SLiDE.share_sector</code></a>, which calculates <span>$\tilde{\delta}_{yr,gg \rightarrow g}$</span>  for <em>all</em> <span>$(gg,g)$</span>, (summary, detail) pairs.</li><li><a href="sector.html#SLiDE._combine_sector_levels"><code>SLiDE._combine_sector_levels</code></a>, which selects relevant summary- and detail-level  goods/sectors defined in <code>set[:sector]</code> and defines how to share the  aggregate (summary)-level goods/sectors into this composite disaggregate-level set.</li></ol><p><strong>Arguments</strong></p><ul><li><code>dataset::String</code>: dataset identifier</li><li><code>d::Dict</code> of DataFrames containing regionally-disaggregated model parameters.</li><li><code>set::Dict</code> of Arrays describing region, sector, final demand, etc.   This should inlude a set <code>set[:sector]</code> listing the summary- and detail-level blueNOTE   codes of interest to include in <code>g</code>.</li></ul><p><strong>Returns</strong></p><ul><li><code>d::Dict</code>: regionally-disaggregated model parameters, updated to include   <code>d[:sector]</code> = <span>$\tilde{\delta}_{yr,gg \rightarrow g}$</span>.</li><li><code>set::Dict</code> of Arrays describing region, sector, final demand, etc.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/share/share_sector.jl#L1-L39">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SLiDE.share_sector" href="#SLiDE.share_sector"><code>SLiDE.share_sector</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">share_sector(df::DataFrame)</code></pre><p>This function calculates and returns a sectoral disaggregation parameter for <em>all</em> <span>$(gg,g)$</span>, (summary, detail) pairs.</p><p class="math-container">\[\tilde{\delta}_{yr,gg \rightarrow g} = \dfrac
    {y_{yr,g} \circ map_{gg\rightarrow g}}
    {\sum_{gg} y_{yr,g} \circ map_{gg\rightarrow g}}\]</p><p><strong>Example</strong></p><p>Looking at a slice of the disaggregate-level <span>$y_{yr,g}$</span> parameter,</p><pre><code class="language-julia-repl">julia&gt; df = read_file(joinpath(SLIDE_DIR,&quot;docs&quot;,&quot;src&quot;,&quot;assets&quot;,&quot;data&quot;,&quot;share_sector-y0_det.csv&quot;))
6×3 DataFrame
│ Row │ yr    │ g       │ value   │
│     │ Int64 │ String  │ Float64 │
├─────┼───────┼─────────┼─────────┤
│ 1   │ 2007  │ ele_uti │ 292.105 │
│ 2   │ 2007  │ gas_uti │ 120.746 │
│ 3   │ 2007  │ wat_uti │ 10.331  │
│ 4   │ 2012  │ ele_uti │ 339.302 │
│ 5   │ 2012  │ gas_uti │ 78.708  │
│ 6   │ 2012  │ wat_uti │ 12.583  │

julia&gt; df = SLiDE.share_sector(df)
6×4 DataFrame
│ Row │ yr     │ summary │ detail  │ value     │
│     │ Int64? │ String? │ String? │ Float64   │
├─────┼────────┼─────────┼─────────┼───────────┤
│ 1   │ 2007   │ uti     │ ele_uti │ 0.690259  │
│ 2   │ 2007   │ uti     │ gas_uti │ 0.285329  │
│ 3   │ 2007   │ uti     │ wat_uti │ 0.0244127 │
│ 4   │ 2012   │ uti     │ ele_uti │ 0.787988  │
│ 5   │ 2012   │ uti     │ gas_uti │ 0.18279   │
│ 6   │ 2012   │ uti     │ wat_uti │ 0.0292225 │</code></pre><p>This ensures <span>$\sum_{g}\tilde{\delta}_{yr,gg \rightarrow g} = 1$</span>.</p><pre><code class="language-julia-repl">julia&gt; combine_over(df, :detail)
2×3 DataFrame
│ Row │ yr     │ summary │ value   │
│     │ Int64? │ String? │ Float64 │
├─────┼────────┼─────────┼─────────┤
│ 1   │ 2007   │ uti     │ 1.0     │
│ 2   │ 2012   │ uti     │ 1.0     │</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/share/share_sector.jl#L71-L123">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SLiDE._combine_sector_levels" href="#SLiDE._combine_sector_levels"><code>SLiDE._combine_sector_levels</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">_combine_sector_levels(df::DataFrame, x::AbstractArray; kwargs...)</code></pre><p>Given a sharing DataFrame that includes level-mapping and a list of all parameters that should be included at the disaggregate level, this function returns a complete mapping DataFrame to scale between mixed levels.</p><p><strong>Arguments</strong></p><ul><li><code>df::DataFrame</code>: sharing DataFrame with columns mapped between levels.</li><li><code>x::AbstractArray</code>: composite of all levels to include on the disaggregate level.</li></ul><p><strong>Keywords</strong></p><ul><li><code>scheme::Pair = :summary=&gt;:detail</code>: columns in <code>df</code> to <strong>dis</strong>aggregate from <span>$\rightarrow$</span> to.</li></ul><p><strong>Returns</strong></p><ul><li><code>df::DataFrame</code>: complete mapping DataFrame to scale between mixed levels.   The (aggregate-level, composite) columns are named <code>(aggr,disagg)</code> such that the sum over   the composite column is one. </li></ul><p><strong>Example</strong></p><p>Focusing on a slice of <span>$\tilde{\delta}_{yr,gg \rightarrow g}$</span>,</p><pre><code class="language-julia-repl">julia&gt; df = read_file(joinpath(SLIDE_DIR,&quot;docs&quot;,&quot;src&quot;,&quot;assets&quot;,&quot;data&quot;,&quot;combine_sector_levels-sector_share.csv&quot;))
8×4 DataFrame
│ Row │ yr    │ summary │ detail  │ value     │
│     │ Int64 │ String  │ String  │ Float64   │
├─────┼───────┼─────────┼─────────┼───────────┤
│ 1   │ 2012  │ oil     │ oil_oil │ 1.0       │
│ 2   │ 2012  │ pet     │ oth_pet │ 0.0299492 │
│ 3   │ 2012  │ pet     │ pav_pet │ 0.015931  │
│ 4   │ 2012  │ pet     │ ref_pet │ 0.941366  │
│ 5   │ 2012  │ pet     │ shn_pet │ 0.0127534 │
│ 6   │ 2012  │ uti     │ ele_uti │ 0.787988  │
│ 7   │ 2012  │ uti     │ gas_uti │ 0.18279   │
│ 8   │ 2012  │ uti     │ wat_uti │ 0.0292225 │

julia&gt; x = [&quot;oil&quot;,&quot;ref_pet&quot;,&quot;uti&quot;,&quot;ele_uti&quot;];

julia&gt; (df, x) = SLiDE._combine_sector_levels(df, x);

julia&gt; df
5×4 DataFrame
│ Row │ yr    │ aggr   │ disagg  │ value     │
│     │ Int64 │ String │ String  │ Float64   │
├─────┼───────┼────────┼─────────┼───────────┤
│ 1   │ 2012  │ oil    │ oil     │ 1.0       │
│ 2   │ 2012  │ pet    │ pet     │ 0.0586336 │
│ 3   │ 2012  │ pet    │ ref_pet │ 0.941366  │
│ 4   │ 2012  │ uti    │ ele_uti │ 0.787988  │
│ 5   │ 2012  │ uti    │ uti     │ 0.212012  │</code></pre><p>In the case that <code>set[:sector]</code>(<span>$g$</span>) includes a disaggregate-level sector without its corresponding aggregate-level code (e.g. <code>ref_pet</code> without <code>pet</code>, as is the case in this example), the aggregate-level code will be added.</p><pre><code class="language-julia-repl">julia&gt; x
5-element Array{String,1}:
 &quot;oil&quot;
 &quot;pet&quot;
 &quot;ref_pet&quot;
 &quot;ele_uti&quot;
 &quot;uti&quot;</code></pre><p>This ensures that <span>$\sum_{g}\tilde{\delta}_{yr,gg \rightarrow g} = 1$</span>.</p><pre><code class="language-julia-repl">julia&gt; combine_over(df, :disagg)
3×3 DataFrame
│ Row │ yr    │ aggr   │ value   │
│     │ Int64 │ String │ Float64 │
├─────┼───────┼────────┼─────────┤
│ 1   │ 2012  │ oil    │ 1.0     │
│ 2   │ 2012  │ pet    │ 1.0     │
│ 3   │ 2012  │ uti    │ 1.0     │</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/share/share_sector.jl#L142-L221">source</a></section></article><h2 id="Disaggregate"><a class="docs-heading-anchor" href="#Disaggregate">Disaggregate</a><a id="Disaggregate-1"></a><a class="docs-heading-anchor-permalink" href="#Disaggregate" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="SLiDE.disagg_sector!" href="#SLiDE.disagg_sector!"><code>SLiDE.disagg_sector!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">disagg_sector!(dataset::String, d::Dict, set::Dict; kwargs...)</code></pre><p>This function performs the sectoral disaggregation for all of the model parameters.</p><ul><li>Taxes (<span>$ta$</span>, <span>$tm$</span>, <span>$ty$</span>) are disaggregated using <a href="sector.html#SLiDE._disagg_sector_map"><code>SLiDE._disagg_sector_map</code></a>.</li><li>All other parameters are disaggregated using <a href="sector.html#SLiDE._disagg_sector_share"><code>SLiDE._disagg_sector_share</code></a>.</li></ul><p>Since disaggregate-level data is available only for 2007 and 2012, the map <code>d[:sector]</code> must be extended using <a href="../../api/functions/filter.html#SLiDE.map_year"><code>SLiDE.map_year</code></a>, so that</p><p class="math-container">\[\tilde{\delta}_{yr,gg \rightarrow g} =
\begin{cases}
\tilde{\delta}_{2007,gg \rightarrow g}  &amp; yr \leq 2009  \\
\tilde{\delta}_{2012,gg \rightarrow g}  &amp; yr &gt; 2009
\end{cases}\]</p><p>where <span>$gg$</span>, <span>$ss$</span> represent aggregate-level goods and sectors and <span>$g$</span>, <span>$s$</span> represent <strong>dis</strong>aggregate-level goods and sectors.</p><p><strong>Arguments</strong></p><ul><li><code>dataset::String</code>: dataset identifier</li><li><code>d::Dict</code> of DataFrames containing the model parameters. This must include <code>d[:sector]</code>,   <span>$\tilde{\delta}_{yr,gg \rightarrow g}$</span>, of sectoral shares.</li><li><code>set::Dict</code> of Arrays describing region, sector, final demand, etc.</li></ul><p><strong>Keywords</strong></p><ul><li><code>scheme::Pair = :aggr=&gt;:disagg</code>: columns in <code>dfmap</code> to <strong>dis</strong>aggregate from <span>$\rightarrow$</span> to</li></ul><p><strong>Returns</strong></p><ul><li><code>d::Dict</code> of DataFrames containing disaggregated model parameters.</li><li><code>set::Dict</code> of Arrays describing region, sector, final demand, etc.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/disagg/disagg_sector.jl#L1-L33">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SLiDE._disagg_sector_share" href="#SLiDE._disagg_sector_share"><code>SLiDE._disagg_sector_share</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">_disagg_sector_share(df::DataFrame, dfmap::DataFrame; kwargs...)</code></pre><p>This function maps <code>df</code> from the aggregate to the disaggregate level and multiplies by the sectoral sharing defined in <code>dfmap</code>. For a parameter <span>$\bar{z}$</span>,</p><p class="math-container">\[\begin{aligned}
\bar{z}_{yr,r,g} = \sum_{gg} \left( \bar{z}_{yr,r,gg} \cdot \tilde{\delta}_{yr,gg \rightarrow g} \right)
\end{aligned}\]</p><p>where <span>$gg$</span>, <span>$ss$</span> represent aggregate-level goods and sectors and <span>$g$</span>, <span>$s$</span> represent <strong>dis</strong>aggregate-level goods and sectors.</p><p>For parameters, such as sectoral output, <span>$ys_{yr,r,ss,gg}$</span>, and intermediate demand, <span>$id_{yr,r,gg,ss}$</span>, that depend on both goods and sectors, <a href="sector.html#SLiDE._compound_for"><code>SLiDE._compound_for</code></a> is used to produce a compound disaggregation map.</p><p class="math-container">\[\begin{aligned}
\bar{id}_{yr,r,g,s} &amp;= \sum_{gg,ss} \left( \bar{id}_{yr,r,gg,ss} \cdot \tilde{\delta}_{yr,gg \rightarrow g,ss \rightarrow s} \right)
\\
\bar{ys}_{yr,r,s,g} &amp;= \sum_{gg,ss} \left( \bar{ys}_{yr,r,ss,gg} \cdot \tilde{\delta}_{yr,ss \rightarrow s,gg \rightarrow g} \right)
\end{aligned}\]</p><p><strong>Arguments</strong></p><ul><li><code>df::DataFrame</code>: parameter to share</li><li><code>dfmap::DataFrame</code>: sharing</li></ul><p><strong>Keywords</strong></p><ul><li><code>scheme::Pair = :aggr=&gt;:disagg</code>: columns in <code>dfmap</code> to <strong>dis</strong>aggregate from <span>$\rightarrow$</span> to</li><li><code>key</code>: If a value is given, print a message indicating that <code>key</code> is being shared.</li></ul><p><strong>Returns</strong></p><ul><li><code>df::DataFrame</code>: shared parameter</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/disagg/disagg_sector.jl#L52-L88">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SLiDE._compound_for" href="#SLiDE._compound_for"><code>SLiDE._compound_for</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">_compound_for(df::DataFrame, col::AbstractArray; kwargs...)</code></pre><p>This function produces a map to disaggregate parameters that include both goods and sectors:</p><p class="math-container">\[\tilde{\delta}_{yr,gg \rightarrow g, ss \rightarrow s} =
    \tilde{\delta}_{yr,gg \rightarrow g} \cdot \tilde{\delta}_{yr, ss \rightarrow s}\]</p><p>where <span>$gg$</span>, <span>$ss$</span> represent aggregate-level goods and sectors and <span>$g$</span>, <span>$s$</span> represent disaggregate-level goods and sectors.</p><p>In the case that we are sharing across both goods and sectors in one data set, this function generates a dataframe with these sharing parameters through the following process:</p><ol><li>Multiply shares for all (<span>$gg\rightarrow g$</span>,<span>$ss\rightarrow s$</span>) combinations.</li><li>Address the case of when aggregate-level goods and sectors are the same (<span>$gg=ss$</span>):<ul><li>If <span>$g = s$</span>, sum all of the share values.</li><li>If <span>$g\neq s$</span>, drop these values.</li></ul></li></ol><p><strong>Example</strong></p><pre><code class="language-julia-repl">julia&gt; df = read_file(joinpath(SLIDE_DIR,&quot;docs&quot;,&quot;src&quot;,&quot;assets&quot;,&quot;data&quot;,&quot;compound_for-sector_share.csv&quot;))
3×4 DataFrame
│ Row │ yr    │ aggr   │ disagg  │ value    │
│     │ Int64 │ String │ String  │ Float64  │
├─────┼───────┼────────┼─────────┼──────────┤
│ 1   │ 2012  │ oil    │ oil     │ 1.0      │
│ 2   │ 2012  │ uti    │ ele_uti │ 0.787988 │
│ 3   │ 2012  │ uti    │ uti     │ 0.212012 │</code></pre><p>First, multiply shares for all (<span>$gg\rightarrow g$</span>,<span>$ss\rightarrow s$</span>) combinations:</p><pre><code class="language-julia">9×6 DataFrame
│ Row │ yr     │ aggr_g  │ disagg_g │ aggr_s  │ disagg_s │ value     │
│     │ Int64? │ String? │ String?  │ String? │ String?  │ Float64   │
├─────┼────────┼─────────┼──────────┼─────────┼──────────┼───────────┤
│ 1   │ 2012   │ oil     │ oil      │ oil     │ oil      │ 1.0       │
│ 2   │ 2012   │ oil     │ oil      │ uti     │ ele_uti  │ 0.787988  │
│ 3   │ 2012   │ oil     │ oil      │ uti     │ uti      │ 0.212012  │
│ 4   │ 2012   │ uti     │ ele_uti  │ oil     │ oil      │ 0.787988  │
│ 5   │ 2012   │ uti     │ ele_uti  │ uti     │ ele_uti  │ 0.620925  │
│ 6   │ 2012   │ uti     │ ele_uti  │ uti     │ uti      │ 0.167063  │
│ 7   │ 2012   │ uti     │ uti      │ oil     │ oil      │ 0.212012  │
│ 8   │ 2012   │ uti     │ uti      │ uti     │ ele_uti  │ 0.167063  │
│ 9   │ 2012   │ uti     │ uti      │ uti     │ uti      │ 0.0449492 │</code></pre><p>Now, for <code>aggr_g==aggr_s</code>, sum all share values for <code>disagg_g==disagg_s</code> and drop values if <code>disagg_g!=disagg_s</code>.</p><pre><code class="language-julia">3×6 DataFrame
│ Row │ yr     │ aggr_g  │ disagg_g │ aggr_s  │ disagg_s │ value    │
│     │ Int64? │ String? │ String?  │ String? │ String?  │ Float64  │
├─────┼────────┼─────────┼──────────┼─────────┼──────────┼──────────┤
│ 1   │ 2012   │ oil     │ oil      │ oil     │ oil      │ 1.0      │
│ 2   │ 2012   │ uti     │ ele_uti  │ uti     │ ele_uti  │ 0.787988 │
│ 3   │ 2012   │ uti     │ uti      │ uti     │ uti      │ 0.212012 │</code></pre><p>The resulting output is:</p><pre><code class="language-julia-repl">julia&gt; SLiDE._compound_for(df, [:g,:s])
7×6 DataFrame
│ Row │ yr     │ aggr_g  │ disagg_g │ aggr_s  │ disagg_s │ value    │
│     │ Int64? │ String? │ String?  │ String? │ String?  │ Float64  │
├─────┼────────┼─────────┼──────────┼─────────┼──────────┼──────────┤
│ 1   │ 2012   │ oil     │ oil      │ oil     │ oil      │ 1.0      │
│ 2   │ 2012   │ oil     │ oil      │ uti     │ ele_uti  │ 0.787988 │
│ 3   │ 2012   │ oil     │ oil      │ uti     │ uti      │ 0.212012 │
│ 4   │ 2012   │ uti     │ ele_uti  │ oil     │ oil      │ 0.787988 │
│ 5   │ 2012   │ uti     │ uti      │ oil     │ oil      │ 0.212012 │
│ 6   │ 2012   │ uti     │ ele_uti  │ uti     │ ele_uti  │ 0.787988 │
│ 7   │ 2012   │ uti     │ uti      │ uti     │ uti      │ 0.212012 │</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/disagg/disagg_sector.jl#L169-L249">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SLiDE._disagg_sector_map" href="#SLiDE._disagg_sector_map"><code>SLiDE._disagg_sector_map</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">_disagg_sector_map(df::DataFrame, dfmap::DataFrame; kwargs...)</code></pre><p>This function maps <code>df</code> from the aggregate to the disaggregate level such that all disaggregate-level goods/sectors have the same value as at the aggregate-level. For a parameter <span>$\bar{z}$</span>,</p><p class="math-container">\[\bar{z}_{yr,r,g} = \bar{z}_{yr,r,gg} \circ map_{gg \rightarrow g}\]</p><p>where <span>$gg$</span>, <span>$ss$</span> represent aggregate-level goods and sectors and <span>$g$</span>, <span>$s$</span> represent <strong>dis</strong>aggregate-level goods and sectors.</p><p><strong>Arguments</strong></p><ul><li><code>df::DataFrame</code>: parameter to map</li><li><code>dfmap::DataFrame</code>: mapping <span>$map_{gg \rightarrow g}$</span> or <span>$\tilde{\delta}_{yr,gg \rightarrow g}$</span></li></ul><p><strong>Keywords</strong></p><ul><li><code>scheme::Pair = :aggr=&gt;:disagg</code>: columns in <code>dfmap</code> to <strong>dis</strong>aggregate from <span>$\rightarrow$</span> to</li><li><code>key</code>: If a value is given, print a message indicating that <code>key</code> is being mapped.</li></ul><p><strong>Returns</strong></p><ul><li><code>df::DataFrame</code>: mapped parameter</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/disagg/disagg_sector.jl#L118-L141">source</a></section></article><h2 id="Aggregate"><a class="docs-heading-anchor" href="#Aggregate">Aggregate</a><a id="Aggregate-1"></a><a class="docs-heading-anchor-permalink" href="#Aggregate" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="SLiDE.aggregate_sector!" href="#SLiDE.aggregate_sector!"><code>SLiDE.aggregate_sector!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">aggregate_sector!(dataset::String, d::Dict, set::Dict; kwargs...)</code></pre><p>This function performs the sectoral aggregation for all of the model parameters.</p><ul><li>Taxes (<span>$ta$</span>, <span>$tm$</span>, <span>$ty$</span>) are aggregated using <a href="sector.html#SLiDE._aggregate_tax_with!"><code>SLiDE._aggregate_tax_with!</code></a>.</li><li>All other parameters are disaggregated using <a href="sector.html#SLiDE._aggregate_sector_map"><code>SLiDE._aggregate_sector_map</code></a>.</li></ul><p><strong>Arguments</strong></p><ul><li><code>dataset::String</code>: dataset identifier</li><li><code>d::Dict</code> of DataFrames containing the model parameters.</li><li><code>set::Dict</code> of Arrays describing region, sector, final demand, etc.</li></ul><p><strong>Keywords</strong></p><ul><li><code>scheme::Pair = :disagg=&gt;:aggr</code>: columns in <code>dfmap</code> to aggregate from <span>$\rightarrow$</span> to</li><li><code>path::String</code>: path to the <a href="https://github.com/NREL/SLiDEData/blob/master/coremaps/scale/sector/eem.csv">defaul sectoral aggregation mapping file</a>.</li></ul><p><strong>Returns</strong></p><ul><li><code>d::Dict</code> of DataFrames containing disaggregated model parameters.</li><li><code>set::Dict</code> of Arrays describing region, sector, final demand, etc.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/aggregate.jl#L1-L19">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SLiDE._aggregate_tax_with!" href="#SLiDE._aggregate_tax_with!"><code>SLiDE._aggregate_tax_with!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">_aggregate_tax_with!(d::Dict, dfmap, kt, k; kwargs...)</code></pre><p>This function is applied to the following tax rates, which are scaled by a the corresponding parameters. It returns the aggregated tax rate as well as the aggregated scaling parameter.</p><ul><li><code>ta(yr,r,g)</code>, absorption taxes, scaled by domestic absorption, <code>a(yr,r,g)</code>:</li></ul><p class="math-container">\[\begin{aligned}
\bar{a}_{yr,r,g} &amp;= \bar{a}_{yr,r,gg} \circ map_{gg\rightarrow g}
\\
\bar{ta}_{yr,r,g} &amp;= \dfrac
    {\left(\bar{ta}_{yr,r,gg} \cdot \bar{a}_{yr,r,gg} \right) \circ map_{gg\rightarrow g}}
    {                                  \bar{a}_{yr,r,g}}
\end{aligned}\]</p><ul><li><code>tm(yr,r,g)</code>, import taxes, scaled by foreign imports, <code>m(yr,r,g)</code>:</li></ul><p class="math-container">\[\begin{aligned}
\bar{m}_{yr,r,g} &amp;= \bar{m}_{yr,r,gg} \circ map_{gg\rightarrow g}
\\
\bar{tm}_{yr,r,g} &amp;= \dfrac
    {\left(\bar{tm}_{yr,r,gg} \cdot \bar{m}_{yr,r,gg} \right) \circ map_{gg\rightarrow g}}
    {                                  \bar{m}_{yr,r,g}}
\end{aligned}\]</p><ul><li><code>ty(yr,r,s)</code>, production taxes, scaled by total regional sectoral output, <code>ys(yr,r,s,g)</code>:</li></ul><p class="math-container">\[\begin{aligned}
\bar{ys}_{yr,r,s,g} &amp;= \bar{ys}_{yr,r,ss,gg} \circ map_{ss\rightarrow s, gg\rightarrow g}
\\
\bar{ty}_{yr,r,s} &amp;= \dfrac
    {\left(\bar{ty}_{yr,r,ss} \cdot \sum_{gg} \bar{ys}_{yr,r,ss,gg} \right) \circ map_{ss\rightarrow s}}
    {                                  \sum_{g}  \bar{ys}_{yr,r,s ,g}}
\end{aligned}\]</p><p>where <span>$gg$</span>, <span>$ss$</span> represent <strong>dis</strong>aggregate-level goods and sectors and <span>$g$</span>, <span>$s$</span> represent aggregate-level goods and sectors.</p><p><strong>Arguments</strong></p><ul><li><code>d::Dict</code> of model parameters</li><li><code>dfmap::DataFrame</code>: mapping <span>$map_{gg\rightarrow g}$</span></li><li><code>kt::Symbol</code>: tax parameter key</li><li><code>k::Symbol</code>: scaling parameter key</li></ul><p><strong>Keywords</strong></p><ul><li><code>scheme::Pair = :disagg=&gt;:aggr</code>: columns in <code>dfmap</code> to aggregate from <span>$\rightarrow$</span> to</li></ul><p><strong>Returns</strong></p><ul><li><code>d[kt]::DataFrame</code>: mapped tax parameter</li><li><code>d[k]::DataFrame</code>: mapped scaling parameter</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/aggregate.jl#L44-L100">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SLiDE._aggregate_sector_map" href="#SLiDE._aggregate_sector_map"><code>SLiDE._aggregate_sector_map</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">_aggregate_sector_map(df::DataFrame, dfmap::DataFrame; kwargs...)</code></pre><p>This function aggregates a parameter in <code>df</code> according to the input map <code>dfmap</code>. For a parameter <span>$\bar{z}$</span>,</p><p class="math-container">\[\bar{z}_{yr,r,g} = \sum_{gg} \left(\bar{z}_{yr,r,gg} \circ map_{gg\rightarrow g} \right)\]</p><p>where <span>$gg$</span>, <span>$ss$</span> represent <strong>dis</strong>aggregate-level goods and sectors and <span>$g$</span>, <span>$s$</span> represent aggregate-level goods and sectors.</p><p><strong>Keywords</strong></p><ul><li><code>scheme::Pair = :disagg=&gt;:aggr</code>: columns in <code>dfmap</code> to aggregate from <span>$\rightarrow$</span> to</li><li><code>key</code>: If a value is given, print a message indicating that <code>key</code> is being mapped.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NREL/SLiDE/blob/f17d9fba0b0d2361476241bf2864c9824b2482e3/src/build/aggregate.jl#L112-L127">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="overview.html">« Overview</a><a class="docs-footer-nextpage" href="../eem/seds.html">SEDS »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 5 February 2021 11:00">Friday 5 February 2021</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
